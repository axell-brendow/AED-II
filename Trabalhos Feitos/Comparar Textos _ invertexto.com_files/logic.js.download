//300x250
//defines global var for saving objects
var creative = {};
creative.count = 0;
/*
 * DON'T MODIFY!: Window onload handler. 
 */
function preInit() {
	setupDom();
	if (Enabler.isInitialized()) {
		init();
	} else {
		Enabler.addEventListener(studio.events.StudioEvent.INIT, init);
	}
}



/*
 * Initializes the ad components
 */
function setupDom() {
	creative.dom = {};
	creative.dom.mainContainer = document.getElementById('main-container');
	creative.dom.exit = document.getElementById('exit');
	
	creative.dom.brand = document.getElementById('brand');
	creative.dom.brand_2 = document.getElementById('brand_2');
	creative.dom.text_1 = document.getElementById('text_1');
	creative.dom.page_1 = document.getElementById('page_1');
	creative.dom.page_2 = document.getElementById('page_2');
	creative.dom.page_3 = document.getElementById('page_3');
	creative.dom.character_1 = document.getElementById('character_1');
	creative.dom.character_2 = document.getElementById('character_2');
	creative.dom.character_3 = document.getElementById('character_3');
	creative.dom.cloud = document.getElementById('cloud');
	creative.dom.animation = document.getElementById('animation');
	creative.dom.gsuite = document.getElementById('gsuite');
	creative.dom.icon_gdrive = document.getElementById('icon_gdrive');
	creative.dom.icon_gmail = document.getElementById('icon_gmail');
	creative.dom.icon_calendar = document.getElementById('icon_calendar');
	creative.dom.icon_documents = document.getElementById('icon_documents');
	creative.dom.icons_block = document.getElementById('icons_block');
	creative.dom.cta = document.getElementById('cta');
	creative.dom.shimmer = document.getElementById('shimmer');
	creative.dom.icons = [creative.dom.icon_calendar,creative.dom.icon_gdrive,creative.dom.icon_documents, creative.dom.icon_gmail];
	//showing exit
	creative.dom.exit.style.display = "block";

	//defining animations

	//defining a main timeline
	creative.dom.characters = new TimelineLite()
		.fromTo(creative.dom.character_1, 0.45, {opacity: 0, scale: 0.3}, {opacity: 1, scale: 1, ease: Power1.easeInOut}, 0.0)
		.fromTo(creative.dom.character_3, 0.45, {opacity: 0, scale: 0.3}, {opacity: 1, scale: 1, ease: Power1.easeInOut}, 0.2)
		.fromTo(creative.dom.character_2, 0.45, {opacity: 0, scale: 0.3}, {opacity: 1, scale: 1, ease: Power1.easeInOut}, 0.4);

	creative.dom.intro = new TimelineLite()
		.to(creative.dom.page_1, 0.95, {left: "+=145px", opacity: 0, ease: Power2.easeInOut}, 0.5)
		.to(creative.dom.character_1, 0.95, {left: "+=105px", ease: Power2.easeInOut}, 0.5)
		.to(creative.dom.page_3, 0.95, {left: "-=145px", opacity: 0, ease: Power2.easeInOut}, 1.2)
		.to(creative.dom.character_3, 0.95, {left: "-=117px", ease: Power2.easeInOut}, 1.2);


	creative.dom.tl = new TimelineLite({paused:true});
	creative.dom.tl.add("init", 0);
	//presets
	creative.dom.tl.to(creative.dom.cta, 0, {opacity: 0}, 0);  
	creative.dom.tl.to(creative.dom.shimmer, 0, {opacity: 0, left: '-110%'}, 0);  
	//animation starts
	creative.dom.tl.add("start", 0);
	//step 1
	creative.dom.tl.to(creative.dom.animation, 0.45, {opacity: 1, ease: Power1.easeInOut}, 0);
	creative.dom.tl.add(creative.dom.characters, 0.7);
	creative.dom.tl.add(creative.dom.intro, 2.0);
	//step 2
	creative.dom.tl.to(creative.dom.animation, 0.45, {opacity: 0, ease: Power1.easeInOut}, 5.0);
	creative.dom.tl.to(creative.dom.text_1, 0.45, {opacity: 1, ease: Power1.easeInOut}, 5.5);
	creative.dom.tl.to(creative.dom.text_1, 0.45, {opacity: 0, ease: Power1.easeInOut}, 8.0);
	creative.dom.tl.to(creative.dom.brand, 0.45, {opacity: 0, ease: Power1.easeInOut}, 8.5);
	creative.dom.tl.to(creative.dom.cloud, 0.45, {opacity: 1, ease: Power1.easeInOut}, 9.0);
	creative.dom.tl.fromTo(creative.dom.gsuite, 0.45, {left: "+=20px"}, {left: "-=20px", opacity: 1, ease: Power1.easeInOut}, 9.5);
	creative.dom.tl.fromTo(creative.dom.icons_block, 0.45, {left: "-=20px"}, {left: "+=20px", opacity: 1, ease: Power1.easeInOut}, 9.5);
	creative.dom.tl.add(TweenMax.staggerFromTo(creative.dom.icons, 0.65, {left: "-=5px"}, {left: "+=5px", opacity: 1, ease: Power2.easeInOut}, 0.2), 9.5);
	//step cta
	creative.dom.tl.fromTo(creative.dom.cta, 0.45, {opacity: 0, scale: 0.3}, {opacity: 1, scale: 1, ease: Power1.easeInOut}, 10);
	creative.dom.tl.to(creative.dom.shimmer, 1.0, {opacity: 1, left: '110%', ease: Power2.easeInOut}, 10.3);
	creative.dom.tl.to(creative.dom.shimmer, 0, {left: "-110%", onComplete: restart}, 12);
}

/*
 * DON'T MODIFY!: Ad initialisation.
 */
function init() {
	addListeners();
	// Polite loading
	if (Enabler.isPageLoaded()) {
		show();
	}
	else {
		Enabler.addEventListener(studio.events.StudioEvent.PAGE_LOADED, show);
		//Enabler.addEventListener(studio.events.StudioEvent.VISIBLE, show);
	}
}

/*
 * DON'T MODIFY!: Adds appropriate listeners at initialization time
 */
function addListeners() {
	creative.dom.exit.addEventListener('click', exitClickHandler);
}

/*
 *  Shows the ad.
 */
function show() {
	creative.dom.tl.play();	
}
function restart(){
	/*if(creative.count == 0){
		creative.count = 1;
		creative.dom.tl.restart();
	}*/
}

// ---------------------------------------------------------------------------------
// MAIN
// ---------------------------------------------------------------------------------

function exitClickHandler() {
	Enabler.exit('BackgroundExit');
}

/*
 *  Main onload handler
 */
window.addEventListener('load', preInit);